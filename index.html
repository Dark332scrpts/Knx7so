<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KnxMain - Central de Ferramentas</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#070a0f;--bg2:#0c1018;--card:#0f141d;--border:#1a2333;--ac:#00d4ff;--glow:rgba(0,212,255,0.18);--txt:#dde6f0;--dim:#4a6080;--ok:#00ff88;--err:#ff4455}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--txt);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(0,212,255,0.03) 40px),repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(0,212,255,0.03) 40px);pointer-events:none;z-index:0}
.orb{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:0;opacity:.3}
.o1{width:500px;height:500px;background:#003a55;top:-200px;left:-150px}
.o2{width:350px;height:350px;background:#001a33;bottom:-100px;right:-100px}
nav{position:sticky;top:0;z-index:100;background:rgba(7,10,15,0.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:58px}
.logo{font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;letter-spacing:3px;color:var(--ac);text-shadow:0 0 20px var(--glow)}
.logo span{color:var(--txt)}
.ver{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--dim);border:1px solid var(--border);padding:3px 10px;border-radius:3px;letter-spacing:2px}
.nav-r{display:flex;gap:1.5rem;align-items:center}
.nav-link{color:var(--dim);font-size:.8rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;text-decoration:none;transition:color .2s}
.nav-link:hover{color:var(--ac)}
.hero{position:relative;z-index:1;padding:4rem 2rem 2rem;text-align:center}
.eyebrow{font-family:'Space Mono',monospace;font-size:.75rem;letter-spacing:4px;color:var(--ac);margin-bottom:1rem;opacity:.8}
h1{font-size:clamp(3rem,8vw,6rem);font-weight:900;letter-spacing:-2px;line-height:.95;margin-bottom:1.5rem}
h1 .k{color:var(--ac);text-shadow:0 0 40px var(--glow)}
.hero p{color:var(--dim);font-size:1rem;max-width:480px;margin:0 auto 2.5rem;line-height:1.7}
.tags{display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap;margin-bottom:3rem}
.tag{font-family:'Space Mono',monospace;font-size:.7rem;letter-spacing:2px;color:var(--ac);border:1px solid rgba(0,212,255,0.25);padding:4px 12px;border-radius:2px;background:rgba(0,212,255,0.05)}
.section{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:0 2rem 5rem}
.sec-head{font-family:'Space Mono',monospace;font-size:.7rem;letter-spacing:4px;text-transform:uppercase;color:var(--dim);margin-bottom:1.5rem;display:flex;align-items:center;gap:1rem}
.sec-head::after{content:'';flex:1;height:1px;background:var(--border)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:1.75rem;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--ac),transparent);opacity:0;transition:opacity .3s}
.card:hover{border-color:rgba(0,212,255,0.4);box-shadow:0 0 30px rgba(0,212,255,0.08);transform:translateY(-2px)}
.card:hover::before{opacity:1}
.card-num{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--dim);letter-spacing:2px;margin-bottom:.75rem}
.card-icon{font-size:2rem;margin-bottom:.75rem;display:block}
.card-title{font-size:1.2rem;font-weight:800;margin-bottom:.4rem}
.card-desc{color:var(--dim);font-size:.83rem;line-height:1.6;margin-bottom:1.25rem}
.btn{display:inline-flex;align-items:center;gap:.4rem;background:var(--ac);color:#070a0f;border:none;border-radius:3px;padding:.5rem 1.1rem;font-family:'Space Mono',monospace;font-size:.78rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all .2s}
.btn:hover{background:#fff;box-shadow:0 0 20px var(--glow)}
.btn-o{background:transparent;color:var(--ac);border:1px solid rgba(0,212,255,0.4)}
.btn-o:hover{background:rgba(0,212,255,0.1);color:var(--ac)}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);z-index:200;align-items:center;justify-content:center;padding:1rem}
.overlay.on{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:2.25rem;max-width:660px;width:100%;position:relative;max-height:92vh;overflow-y:auto;animation:mup .2s ease}
@keyframes mup{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.mcl{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--dim);font-size:1.3rem;cursor:pointer}
.mcl:hover{color:var(--err)}
.mtitle{font-size:1.5rem;font-weight:900;margin-bottom:.2rem}
.msub{color:var(--dim);font-size:.82rem;margin-bottom:1.5rem;font-family:'Space Mono',monospace;letter-spacing:1px}
label{display:block;color:var(--dim);font-family:'Space Mono',monospace;font-size:.68rem;letter-spacing:2px;text-transform:uppercase;margin:.9rem 0 .35rem}
textarea,input{width:100%;background:#070a0f;border:1px solid var(--border);border-radius:4px;color:var(--txt);font-family:'Space Mono',monospace;font-size:.82rem;padding:.65rem .9rem;outline:none;transition:border-color .2s;resize:vertical}
textarea:focus,input:focus{border-color:var(--ac)}
textarea{min-height:130px}
.mact{display:flex;gap:.6rem;margin-top:1.1rem;flex-wrap:wrap}
.rbox{background:#070a0f;border:1px solid var(--ok);border-radius:4px;padding:1rem;margin-top:1rem;font-family:'Space Mono',monospace;font-size:.78rem;color:var(--ok);display:none;line-height:1.7;white-space:pre-wrap;word-break:break-all}
.rbox.on{display:block}
.rbox.err{border-color:var(--err);color:var(--err)}
.cp-line{display:block;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.25);border-radius:4px;padding:.5rem .75rem;margin:.3rem 0;color:var(--ac);cursor:pointer;word-break:break-all;transition:background .2s;font-size:.8rem}
.cp-line:hover{background:rgba(0,212,255,0.18)}
.cp-line::before{content:'üìã ';font-size:.7rem}
.badge{display:inline-block;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.3);color:var(--ac);font-family:'Space Mono',monospace;font-size:.65rem;padding:2px 8px;border-radius:2px;margin-bottom:.75rem;letter-spacing:1px}
.toast-wrap{position:fixed;bottom:1.5rem;right:1.5rem;z-index:500;display:flex;flex-direction:column;gap:.4rem;pointer-events:none}
.toast{background:var(--card);border:1px solid var(--ok);color:var(--ok);padding:.5rem 1rem;border-radius:4px;font-family:'Space Mono',monospace;font-size:.75rem;animation:tin .3s ease,tout .3s 2.5s ease forwards}
.toast.e{border-color:var(--err);color:var(--err)}
@keyframes tin{from{transform:translateX(30px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes tout{to{opacity:0;transform:translateX(20px)}}
footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:1.25rem 2rem;text-align:center;color:var(--dim);font-family:'Space Mono',monospace;font-size:.7rem}
@media(max-width:600px){.nav-link{display:none}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div>
<div class="toast-wrap" id="tw"></div>

<nav>
  <div class="logo"><span>Knx</span>Main</div>
  <div class="nav-r">
    <a class="nav-link" href="#">Ferramentas</a>
    <a class="nav-link" href="#">Gratuito</a>
    <span class="ver">v2.0</span>
  </div>
</nav>

<div class="hero">
  <div class="eyebrow">// Central de Ferramentas para Scripts Roblox</div>
  <h1><span class="k">Knx</span>Main</h1>
  <p>Proteja seus scripts. Gera link com acesso negado, key system autom√°tico e muito mais.</p>
  <div class="tags">
    <span class="tag">üîí ACESSO NEGADO</span>
    <span class="tag">üóùÔ∏è KEY SYSTEM AUTO</span>
    <span class="tag">üÜì GRATUITO</span>
    <span class="tag">üåê ONLINE</span>
  </div>
</div>

<div class="section">
  <div class="sec-head">// Ferramentas</div>
  <div class="grid">

    <div class="card" onclick="op('protector')">
      <div class="card-num">01 ‚Äî</div>
      <span class="card-icon">üîí</span>
      <div class="card-title">KnxProtector</div>
      <div class="card-desc">Cola script ‚Üí gera loadstring. Quem abrir o link direto v√™ <strong style="color:var(--err)">ACESSO NEGADO</strong>. Sem bot√£o de voltar, sem escape.</div>
      <button class="btn">Acessar KnxProtector</button>
    </div>

    <div class="card" onclick="op('recuperar')">
      <div class="card-num">02 ‚Äî</div>
      <span class="card-icon">üîì</span>
      <div class="card-title">Recuperar Script</div>
      <div class="card-desc">Cole o ID interno (12 chars) que voc√™ salvou ‚Üí o site mostra seu script. S√≥ funciona com ID deste PC.</div>
      <button class="btn">Recuperar Script</button>
    </div>

    <div class="card" onclick="op('keysystem')">
      <div class="card-num">03 ‚Äî</div>
      <span class="card-icon">üóùÔ∏è</span>
      <div class="card-title">Key System</div>
      <div class="card-desc">Key vira <strong style="color:var(--ac)">hash FNV-1a</strong> no c√≥digo. Script vira <strong style="color:var(--ac)">Base64</strong>. Ningu√©m v√™ a key nem o script em texto puro.</div>
      <button class="btn">Acessar Key System</button>
    </div>

    <div class="card" onclick="op('loadstring')">
      <div class="card-num">04 ‚Äî</div>
      <span class="card-icon">‚ö°</span>
      <div class="card-title">KnxLoadstring</div>
      <div class="card-desc">Cole qualquer link raw e gere o loadstring pronto pra copiar no executor do Roblox.</div>
      <button class="btn">Acessar Loadstring</button>
    </div>

    <div class="card" onclick="op('curtor')">
      <div class="card-num">05 ‚Äî</div>
      <span class="card-icon">üéØ</span>
      <div class="card-title">KnxCurtor</div>
      <div class="card-desc">Gera p√°gina de divulga√ß√£o com contador regressivo. Pessoa espera, se inscreve no canal e pega o script.</div>
      <button class="btn">Acessar KnxCurtor</button>
    </div>

    <div class="card" onclick="op('checker')">
      <div class="card-num">06 ‚Äî</div>
      <span class="card-icon">üîç</span>
      <div class="card-title">KnxChecker</div>
      <div class="card-desc">Verifica erros de sintaxe Lua no script antes de publicar. Mostra estat√≠sticas do c√≥digo.</div>
      <button class="btn">Acessar KnxChecker</button>
    </div>

  </div>
</div>

<!-- MODAIS -->

<!-- KNXPROTECTOR -->
<div class="overlay" id="m-protector">
<div class="modal">
  <button class="mcl" onclick="cl('protector')">‚úï</button>
  <div class="mtitle">üîí KnxProtector</div>
  <div class="msub">// cola script ‚Üí gera loadstring com acesso negado</div>
  <div class="badge">COMO FUNCIONA</div>
  <div style="color:var(--dim);font-family:'Space Mono',monospace;font-size:.75rem;line-height:1.8;margin-bottom:1rem">
    1. Cole seu script aqui<br>
    2. Gera um loadstring √∫nico<br>
    3. Quem abrir o link direto v√™ ACESSO NEGADO ‚õî (sem bot√£o de voltar)<br>
    4. S√≥ funciona via loadstring no executor do Roblox<br>
    5. Guarde o ID interno em vermelho para recuperar seu script depois
  </div>
  <label>Cole seu Script Lua</label>
  <textarea id="prot-in" placeholder="-- Cole seu script aqui..."></textarea>
  <div class="mact">
    <button class="btn" onclick="protGen()">üîí Gerar LoadString Protegido</button>
  </div>
  <div class="rbox" id="prot-r"></div>
</div>
</div>

<!-- RECUPERAR SCRIPT -->
<div class="overlay" id="m-recuperar">
<div class="modal">
  <button class="mcl" onclick="cl('recuperar')">‚úï</button>
  <div class="mtitle">üîì Recuperar Script</div>
  <div class="msub">// cole o ID interno de 12 caracteres que voc√™ salvou</div>
  <div class="badge">S√ì FUNCIONA COM ID GERADO NESTE NAVEGADOR/PC</div>
  <label>ID Interno (12 caracteres ‚Äî mostrado em vermelho ao gerar)</label>
  <input type="text" id="rec-id" placeholder="Ex: aBcDeFgHiJkL" maxlength="20">
  <div class="mact">
    <button class="btn" onclick="recScript()">üîì Recuperar Meu Script</button>
  </div>
  <div class="rbox" id="rec-r"></div>
  <div class="mact" id="rec-a" style="display:none">
    <button class="btn btn-o" onclick="cpBox('rec-code')">üìã Copiar Script</button>
    <button class="btn btn-o" onclick="saveRec()">üíæ Salvar .lua</button>
  </div>
  <textarea id="rec-code" style="display:none"></textarea>
</div>
</div>

<!-- KEY SYSTEM -->
<div class="overlay" id="m-keysystem">
<div class="modal">
  <button class="mcl" onclick="cl('keysystem')">‚úï</button>
  <div class="mtitle">üóùÔ∏è Key System</div>
  <div class="msub">// key em hash + script em Base64 no c√≥digo gerado</div>
  <div class="badge">PROTE√á√ÉO REAL</div>
  <div style="color:var(--dim);font-family:'Space Mono',monospace;font-size:.75rem;line-height:1.8;margin-bottom:1rem">
    üîê A key vira hash FNV-1a ‚Äî ningu√©m v√™ a key original no .lua<br>
    üì¶ O script vira Base64 ‚Äî n√£o d√° pra ler diretamente no c√≥digo<br>
    ‚úÖ S√≥ decoda e executa se a key digitada bater com o hash<br>
    üö´ Ap√≥s 5 tentativas erradas a GUI fecha automaticamente
  </div>
  <label>Cole seu Script Lua</label>
  <textarea id="ks-script" placeholder="-- Cole seu script aqui...&#10;-- Ele ser√° embutido em Base64 no c√≥digo gerado!"></textarea>
  <label>Nome do Script</label>
  <input type="text" id="ks-nome" placeholder="Meu Script OP" value="KnxScript">
  <label>Link pra pegar a key (Discord, YouTube, etc)</label>
  <input type="url" id="ks-link" placeholder="https://discord.gg/...">
  <label>Key personalizada (deixe vazio pra gerar autom√°tico)</label>
  <input type="text" id="ks-key" placeholder="Vazio = gera autom√°tico   ex: KNX-ABCD-1234">
  <div class="mact">
    <button class="btn" onclick="genKeySys()">üóùÔ∏è Gerar Key System Protegido</button>
  </div>
  <div class="rbox" id="ks-r"></div>
</div>
</div>

<!-- LOADSTRING -->
<div class="overlay" id="m-loadstring">
<div class="modal">
  <button class="mcl" onclick="cl('loadstring')">‚úï</button>
  <div class="mtitle">‚ö° KnxLoadstring</div>
  <div class="msub">// transforma link raw em loadstring</div>
  <label>Link Raw do Script</label>
  <input type="url" id="ls-url" placeholder="https://raw.githubusercontent.com/...">
  <div class="mact">
    <button class="btn" onclick="genLS()">‚ö° Gerar LoadString</button>
  </div>
  <div class="rbox" id="ls-r"></div>
  <div class="mact" id="ls-a" style="display:none">
    <button class="btn btn-o" onclick="cpBox('ls-r')">üìã Copiar</button>
  </div>
</div>
</div>

<!-- KNXCURTOR -->
<div class="overlay" id="m-curtor">
<div class="modal">
  <button class="mcl" onclick="cl('curtor')">‚úï</button>
  <div class="mtitle">üéØ KnxCurtor</div>
  <div class="msub">// p√°gina de divulga√ß√£o com contador</div>
  <label>T√≠tulo do Script</label>
  <input type="text" id="cur-titulo" placeholder="Script Fly OP">
  <label>Criador / Seu nome</label>
  <input type="text" id="cur-criador" placeholder="KnxDev">
  <label>Link do Script (seu loadstring ou raw)</label>
  <input type="url" id="cur-link" placeholder="https://...">
  <label>Canal YouTube (opcional)</label>
  <input type="url" id="cur-yt" placeholder="https://youtube.com/@seucanal">
  <label>Tempo de espera (segundos)</label>
  <input type="number" id="cur-tempo" value="15" min="5" max="60">
  <div class="mact">
    <button class="btn" onclick="genCurtor()">üéØ Gerar P√°gina</button>
  </div>
  <div class="rbox" id="cur-r"></div>
  <div class="mact" id="cur-a" style="display:none">
    <button class="btn" onclick="prevCurtor()">üëÅÔ∏è Visualizar</button>
    <button class="btn btn-o" onclick="saveCurtor()">üíæ Salvar HTML</button>
  </div>
</div>
</div>

<!-- CHECKER -->
<div class="overlay" id="m-checker">
<div class="modal">
  <button class="mcl" onclick="cl('checker')">‚úï</button>
  <div class="mtitle">üîç KnxChecker</div>
  <div class="msub">// verifica erros de sintaxe Lua</div>
  <label>Cole seu Script</label>
  <textarea id="chk-in" placeholder="-- Cole seu script Lua aqui..."></textarea>
  <div class="mact"><button class="btn" onclick="checkScript()">üîç Verificar</button></div>
  <div class="rbox" id="chk-r"></div>
</div>
</div>

<footer>KnxMain v2.0 &nbsp;¬∑&nbsp; Central de Ferramentas para Scripts Roblox &nbsp;¬∑&nbsp; Gratuito &amp; Online</footer>

<script>
// ===== UTILS =====
var G = function(id){ return document.getElementById(id); };

function toast(m, e){
  var t = document.createElement('div');
  t.className = 'toast'+(e?' e':'');
  t.textContent = m;
  G('tw').appendChild(t);
  setTimeout(function(){ t.remove(); }, 3000);
}

function op(id){ G('m-'+id).classList.add('on'); }
function cl(id){ G('m-'+id).classList.remove('on'); }
document.querySelectorAll('.overlay').forEach(function(o){
  o.addEventListener('click',function(e){ if(e.target===o) o.classList.remove('on'); });
});

function showR(id,txt,err){
  var el=G(id); el.textContent=txt;
  el.className='rbox on'+(err?' err':'');
}

function cpBox(id){
  var txt=G(id).tagName==='TEXTAREA'?G(id).value:G(id).textContent;
  navigator.clipboard.writeText(txt.trim()).then(function(){ toast('‚úÖ Copiado!'); });
}

function cpText(txt){
  navigator.clipboard.writeText(txt).then(function(){ toast('‚úÖ Copiado!'); });
}

function escQ(s){ return s.replace(/\\/g,'\\\\').replace(/'/g,"\\'"); }
function escHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// ===== STORAGE =====
function getDB(){ try{ return JSON.parse(localStorage.getItem('knxdb')||'{}'); }catch(e){ return {}; } }
function setDB(d){ localStorage.setItem('knxdb',JSON.stringify(d)); }

// Gera ID √∫nico 12 chars
function genUID(){
  var c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',r='';
  for(var i=0;i<12;i++) r+=c[Math.floor(Math.random()*c.length)];
  return r;
}

// Gera key aleat√≥ria KNX-XXXX-XXXX-XXXX
function genKeyRand(){
  var c='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  function p(n){ var s=''; for(var i=0;i<n;i++) s+=c[Math.floor(Math.random()*c.length)]; return s; }
  return 'KNX-'+p(4)+'-'+p(4)+'-'+p(4);
}

// Base64 encode (JS nativo)
function b64enc(str){
  try{ return btoa(unescape(encodeURIComponent(str))); }catch(e){ return btoa(str); }
}

// FNV-1a hash 32bit ‚Äî compat√≠vel com bit32 do Roblox
function fnv1a(str){
  var h=0x811c9dc5;
  for(var i=0;i<str.length;i++){
    h=h^str.charCodeAt(i);
    h=Math.imul(h,0x01000193);
    h=h>>>0;
  }
  return ('00000000'+h.toString(16)).slice(-8);
}

// SHA-256 via SubtleCrypto (apenas para exibir info pro usu√°rio)
async function sha256(msg){
  var buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(msg));
  return Array.from(new Uint8Array(buf)).map(function(b){ return b.toString(16).padStart(2,'0'); }).join('');
}

// ===== VERIFICAR URL AO CARREGAR =====
window.addEventListener('load',function(){
  var params=new URLSearchParams(window.location.search);

  // Link p√∫blico ?s= ‚Üí ACESSO NEGADO, SEM bot√£o de voltar, SEM link pro site
  if(params.has('s')){
    document.body.innerHTML=
      '<style>*{margin:0;padding:0;box-sizing:border-box}body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#070a0f;flex-direction:column;font-family:"Space Mono",monospace;text-align:center;padding:2rem;user-select:none}</style>'+
      '<div style="font-size:5rem;margin-bottom:1.2rem">‚õî</div>'+
      '<div style="font-size:2.2rem;font-weight:900;color:#ff4455;margin-bottom:.6rem;letter-spacing:2px">ACESSO NEGADO</div>'+
      '<div style="color:#4a6080;font-size:.9rem;max-width:380px;line-height:1.8;margin-bottom:2rem">'+
      'Este script est√° protegido.<br>'+
      'Voc√™ n√£o tem permiss√£o para acessar este conte√∫do diretamente.<br><br>'+
      'Use o loadstring fornecido pelo criador no seu executor.</div>'+
      '<div style="background:#0c1018;border:1px solid #1a2333;border-radius:8px;padding:1rem 1.5rem;color:#4a6080;font-size:.75rem;font-family:monospace">‚õî 403 Forbidden ‚Äî KnxMain Protection System</div>';
    // Bloqueia navega√ß√£o de volta
    history.pushState(null,'',window.location.href);
    window.addEventListener('popstate',function(){ history.pushState(null,'',window.location.href); });
    return;
  }

  // ?raw= ‚Üí no browser tamb√©m bloqueia, sem link de volta
  if(params.has('raw')){
    document.body.innerHTML=
      '<style>*{margin:0;padding:0;box-sizing:border-box}body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#070a0f;flex-direction:column;font-family:"Space Mono",monospace;text-align:center;padding:2rem;user-select:none}</style>'+
      '<div style="font-size:5rem;margin-bottom:1.2rem">‚õî</div>'+
      '<div style="font-size:2.2rem;font-weight:900;color:#ff4455;margin-bottom:.6rem;letter-spacing:2px">ACESSO NEGADO</div>'+
      '<div style="color:#4a6080;font-size:.9rem;max-width:380px;line-height:1.8">'+
      'Acesso via navegador n√£o permitido.<br>'+
      'Este conte√∫do s√≥ pode ser acessado pelo executor do Roblox.</div>';
    history.pushState(null,'',window.location.href);
    window.addEventListener('popstate',function(){ history.pushState(null,'',window.location.href); });
    return;
  }
});

// ===== KNXPROTECTOR =====
function protGen(){
  var code=G('prot-in').value.trim();
  if(!code){ toast('‚ö†Ô∏è Cole um script!',true); return; }

  var uid=genUID();
  var db=getDB();
  // Salva em Base64 (n√£o em texto puro no localStorage)
  db[uid]={ b64: b64enc(code), date: new Date().toLocaleString('pt-BR') };
  setDB(db);

  var SITE_URL=window.location.href.split('?')[0];
  var rawLink=SITE_URL+'?raw='+uid;
  var pubLink=SITE_URL+'?s='+uid;
  var loadstring='loadstring(game:HttpGet("'+rawLink+'"))()';

  var box=G('prot-r');
  box.className='rbox on';
  box.innerHTML=
    '<span style="color:var(--ok)">‚úÖ SCRIPT PROTEGIDO COM SUCESSO!</span>\n\n'+
    '<span style="color:var(--dim)">‚ö° LoadString (divulgue isso no Discord/YouTube):</span>\n'+
    '<span class="cp-line" onclick="cpText(\''+escQ(loadstring)+'\')">'+escHtml(loadstring)+'</span>\n\n'+
    '<span style="color:var(--dim)">üîó Link p√∫blico (quem abrir v√™ ACESSO NEGADO):</span>\n'+
    '<span class="cp-line" onclick="cpText(\''+escQ(pubLink)+'\')">'+escHtml(pubLink)+'</span>\n\n'+
    '<span style="color:#ff4455;font-weight:700">‚ö†Ô∏è GUARDE ESTE ID PARA RECUPERAR SEU SCRIPT:</span>\n'+
    '<span class="cp-line" onclick="cpText(\''+uid+'\')">'+uid+'</span>\n\n'+
    '<span style="color:#4a6080;font-size:.72rem">'+
    'üí° Clique em qualquer linha azul para copiar\n'+
    '‚ö†Ô∏è O ID s√≥ funciona neste navegador/PC\n'+
    'üíæ Guarde o ID em um bloco de notas ‚Äî se perder, perde o script!</span>';

  toast('‚úÖ Script protegido! Guarde o ID em vermelho!');
}

// ===== RECUPERAR SCRIPT =====
// Usa ID diretamente ‚Äî n√£o aceita o loadstring para evitar engenharia reversa pelo URL
function recScript(){
  var input=G('rec-id').value.trim();
  if(!input){ toast('‚ö†Ô∏è Cole o ID interno!',true); return; }

  var match=input.match(/([A-Za-z0-9]{12})/);
  if(!match){
    showR('rec-r','‚ùå ID inv√°lido.\n\nO ID interno tem exatamente 12 caracteres (letras e n√∫meros).\nEle fica em vermelho ao gerar o script protegido.',true);
    return;
  }

  var uid=match[1];
  var db=getDB();

  if(db[uid] && db[uid].b64){
    var decoded;
    try{ decoded=decodeURIComponent(escape(atob(db[uid].b64))); }
    catch(e){ decoded=atob(db[uid].b64); }
    G('rec-code').value=decoded;
    showR('rec-r','‚úÖ SCRIPT RECUPERADO!\n\nData de cria√ß√£o: '+db[uid].date+'\n\nClique em "Copiar Script" ou "Salvar .lua" abaixo.');
    G('rec-a').style.display='flex';
    toast('‚úÖ Script recuperado!');
  } else {
    showR('rec-r','‚ùå Script n√£o encontrado.\n\nPoss√≠veis motivos:\n‚Ä¢ N√£o foi gerado neste navegador/PC\n‚Ä¢ O localStorage foi limpo\n‚Ä¢ ID incorreto\n\nSempre guarde o ID vermelho ao gerar.',true);
  }
}

function saveRec(){
  var a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([G('rec-code').value],{type:'text/plain'}));
  a.download='script_recuperado.lua'; a.click();
}

// ===== KEY SYSTEM =====
// CORRIGIDO: key ‚Üí hash FNV-1a no Lua, script ‚Üí Base64 no Lua
// Ningu√©m l√™ a key nem o script em texto puro no .lua gerado
async function genKeySys(){
  var script=G('ks-script').value.trim();
  var nome=G('ks-nome').value.trim()||'KnxScript';
  var linkKey=G('ks-link').value.trim()||'https://discord.gg/knxmain';
  var keyCustom=G('ks-key').value.trim();
  var key=keyCustom||genKeyRand();

  if(!script){ toast('‚ö†Ô∏è Cole seu script!',true); return; }

  // Gera hashes
  var keyFNV=fnv1a(key);
  var keyHash=await sha256(key); // s√≥ pra mostrar pro dono

  // Script em Base64
  var scriptB64=b64enc(script);

  // O Lua usa FNV-1a (bit32 nativo do Roblox)
  // A key NUNCA aparece em texto ‚Äî s√≥ o hash de 8 chars hex
  var lua=
'--[[\n'+
'  Key System protegido pelo KnxMain v2.0\n'+
'  Script  : '+nome+'\n'+
'  Link key: '+linkKey+'\n'+
'  AVISO   : A key e o script nao estao em texto puro neste arquivo.\n'+
']]\n\n'+
'local NOME_SCRIPT = "'+nome+'"\n'+
'local LINK_KEY    = "'+linkKey+'"\n\n'+
'-- Hash FNV-1a da key (nao e a key em texto)\n'+
'local KEY_FNV = "'+keyFNV+'"\n\n'+
'-- Script codificado em Base64 (nao esta em texto puro)\n'+
'local SCRIPT_B64 = "'+scriptB64+'"\n\n'+
'-- Hash FNV-1a identico ao JavaScript (bit32 nativo)\n'+
'local function fnv1a(s)\n'+
'    local h = 0x811c9dc5\n'+
'    for i = 1, #s do\n'+
'        h = bit32.bxor(h, string.byte(s, i))\n'+
'        h = bit32.band(bit32.bnot(0) + 1 + h + h * 0x1000000 - h * 0x1000000 + h * 0x10000 - h * 0x10000 + h * 0x200 - h * 0x200 + h * 0x80 - h * 0x80 + h * 0x8 - h * 0x8 + h, 0xFFFFFFFF)\n'+
'    end\n'+
'    return string.format("%08x", h)\n'+
'end\n\n'+
'-- Funcao FNV-1a correta para Roblox\n'+
'local function hashKey(s)\n'+
'    local h = 2166136261\n'+
'    for i = 1, #s do\n'+
'        h = bit32.bxor(h, string.byte(s,i))\n'+
'        h = (h * 16777619) % 4294967296\n'+
'    end\n'+
'    return string.format("%08x", h)\n'+
'end\n\n'+
'-- Decoder Base64 para Luau\n'+
'local b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"\n'+
'local function b64decode(data)\n'+
'    local result = {}\n'+
'    data = data:gsub("[^"..b64.."=]", "")\n'+
'    for i = 1, #data, 4 do\n'+
'        local a=(b64:find(data:sub(i,i)) or 1)-1\n'+
'        local b=(b64:find(data:sub(i+1,i+1)) or 1)-1\n'+
'        local c=(b64:find(data:sub(i+2,i+2)) or 65)-1\n'+
'        local d=(b64:find(data:sub(i+3,i+3)) or 65)-1\n'+
'        local n=bit32.lshift(a,18)+bit32.lshift(b,12)+bit32.lshift(c,6)+d\n'+
'        table.insert(result, string.char(bit32.rshift(n,16)))\n'+
'        if data:sub(i+2,i+2)~="=" then\n'+
'            table.insert(result, string.char(bit32.band(bit32.rshift(n,8),255)))\n'+
'        end\n'+
'        if data:sub(i+3,i+3)~="=" then\n'+
'            table.insert(result, string.char(bit32.band(n,255)))\n'+
'        end\n'+
'    end\n'+
'    return table.concat(result)\n'+
'end\n\n'+
'-- GUI\n'+
'local player = game.Players.LocalPlayer\n'+
'local pGui   = player.PlayerGui\n'+
'pcall(function() if pGui:FindFirstChild("_KnxKeyGui") then pGui._KnxKeyGui:Destroy() end end)\n\n'+
'local gui = Instance.new("ScreenGui", pGui)\n'+
'gui.Name = "_KnxKeyGui"\n'+
'gui.ResetOnSpawn = false\n\n'+
'local bg = Instance.new("Frame", gui)\n'+
'bg.Size = UDim2.new(0,440,0,265)\n'+
'bg.Position = UDim2.new(0.5,-220,0.5,-132)\n'+
'bg.BackgroundColor3 = Color3.fromRGB(10,10,18)\n'+
'bg.BorderSizePixel = 0\n'+
'Instance.new("UICorner",bg).CornerRadius = UDim.new(0,14)\n'+
'local stroke = Instance.new("UIStroke",bg)\n'+
'stroke.Color = Color3.fromRGB(0,180,255)\n'+
'stroke.Thickness = 1.5\n\n'+
'local hdr = Instance.new("Frame",bg)\n'+
'hdr.Size = UDim2.new(1,0,0,54)\n'+
'hdr.BackgroundColor3 = Color3.fromRGB(0,105,210)\n'+
'hdr.BorderSizePixel = 0\n'+
'Instance.new("UICorner",hdr).CornerRadius = UDim.new(0,14)\n'+
'local fixHdr = Instance.new("Frame",hdr)\n'+
'fixHdr.Size = UDim2.new(1,0,0.5,0)\n'+
'fixHdr.Position = UDim2.new(0,0,0.5,0)\n'+
'fixHdr.BackgroundColor3 = Color3.fromRGB(0,105,210)\n'+
'fixHdr.BorderSizePixel = 0\n\n'+
'local titLbl = Instance.new("TextLabel",hdr)\n'+
'titLbl.Text = "[KnxMain] '+nome+'"\n'+
'titLbl.Size = UDim2.new(1,0,1,0)\n'+
'titLbl.BackgroundTransparency = 1\n'+
'titLbl.TextColor3 = Color3.fromRGB(255,255,255)\n'+
'titLbl.Font = Enum.Font.GothamBold\n'+
'titLbl.TextSize = 14\n\n'+
'local subLbl = Instance.new("TextLabel",bg)\n'+
'subLbl.Text = "Pegue a key em: "..LINK_KEY\n'+
'subLbl.Size = UDim2.new(1,-20,0,30)\n'+
'subLbl.Position = UDim2.new(0,10,0,62)\n'+
'subLbl.BackgroundTransparency = 1\n'+
'subLbl.TextColor3 = Color3.fromRGB(100,155,210)\n'+
'subLbl.Font = Enum.Font.Gotham\n'+
'subLbl.TextSize = 12\n'+
'subLbl.TextWrapped = true\n\n'+
'local inputBox = Instance.new("TextBox",bg)\n'+
'inputBox.PlaceholderText = "Cole sua key aqui..."\n'+
'inputBox.Size = UDim2.new(1,-20,0,50)\n'+
'inputBox.Position = UDim2.new(0,10,0,100)\n'+
'inputBox.BackgroundColor3 = Color3.fromRGB(18,18,30)\n'+
'inputBox.TextColor3 = Color3.fromRGB(255,255,255)\n'+
'inputBox.Font = Enum.Font.Code\n'+
'inputBox.TextSize = 13\n'+
'inputBox.BorderSizePixel = 0\n'+
'inputBox.ClearTextOnFocus = false\n'+
'Instance.new("UICorner",inputBox).CornerRadius = UDim.new(0,8)\n\n'+
'local btnOk = Instance.new("TextButton",bg)\n'+
'btnOk.Text = "Confirmar Key"\n'+
'btnOk.Size = UDim2.new(1,-20,0,48)\n'+
'btnOk.Position = UDim2.new(0,10,0,162)\n'+
'btnOk.BackgroundColor3 = Color3.fromRGB(0,155,75)\n'+
'btnOk.TextColor3 = Color3.fromRGB(255,255,255)\n'+
'btnOk.Font = Enum.Font.GothamBold\n'+
'btnOk.TextSize = 14\n'+
'btnOk.BorderSizePixel = 0\n'+
'Instance.new("UICorner",btnOk).CornerRadius = UDim.new(0,8)\n\n'+
'local attempts = 0\n\n'+
'local function resetUI()\n'+
'    task.wait(1.5)\n'+
'    inputBox.BackgroundColor3 = Color3.fromRGB(18,18,30)\n'+
'    hdr.BackgroundColor3 = Color3.fromRGB(0,105,210)\n'+
'    fixHdr.BackgroundColor3 = Color3.fromRGB(0,105,210)\n'+
'    titLbl.Text = "[KnxMain] '+nome+'"\n'+
'    btnOk.Text = "Confirmar Key"\n'+
'end\n\n'+
'btnOk.MouseButton1Click:Connect(function()\n'+
'    -- Compara hash FNV-1a da key digitada com o hash pre-computado\n'+
'    -- A key original NUNCA esta no codigo\n'+
'    if hashKey(inputBox.Text) == KEY_FNV then\n'+
'        gui:Destroy()\n'+
'        local decoded = b64decode(SCRIPT_B64)\n'+
'        local fn, err = loadstring(decoded)\n'+
'        if fn then\n'+
'            fn()\n'+
'        else\n'+
'            warn("[KnxMain] Erro: "..tostring(err))\n'+
'        end\n'+
'    else\n'+
'        attempts = attempts + 1\n'+
'        inputBox.BackgroundColor3 = Color3.fromRGB(80,15,15)\n'+
'        hdr.BackgroundColor3 = Color3.fromRGB(160,30,30)\n'+
'        fixHdr.BackgroundColor3 = Color3.fromRGB(160,30,30)\n'+
'        titLbl.Text = "Key errada! ("..attempts.."/5)"\n'+
'        btnOk.Text = "Tente novamente"\n'+
'        task.spawn(resetUI)\n'+
'        if attempts >= 5 then\n'+
'            gui:Destroy()\n'+
'        end\n'+
'    end\n'+
'end)\n';

  window._ksLastCode=lua;
  window._ksLastKey=key;

  var box=G('ks-r');
  box.className='rbox on';
  box.innerHTML=
    '<span style="color:var(--ok)">‚úÖ KEY SYSTEM GERADO COM PROTE√á√ÉO REAL!</span>\n\n'+
    '<span style="color:#ff4455;font-weight:700">üóùÔ∏è Sua Key (GUARDE ISSO ‚Äî n√£o aparece no .lua!):</span>\n'+
    '<span class="cp-line" onclick="cpText(\''+escQ(key)+'\')">'+escHtml(key)+'</span>\n\n'+
    '<span style="color:var(--dim)">üîê O que fica no .lua (hash FNV-1a ‚Äî n√£o √© a key):</span>\n'+
    '<span style="color:#4a6080;font-size:.71rem;display:block;margin:.2rem 0 .4rem">Ningu√©m consegue reverter o hash para descobrir a key original</span>'+
    '<span style="color:#4a6080;font-family:\'Space Mono\',monospace;font-size:.75rem;display:block;margin-bottom:.7rem">'+keyFNV+' (FNV-1a)</span>'+
    '<div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.3rem">'+
    '<button class="btn" onclick="cpLuaCode()">üìã Copiar C√≥digo Lua</button>'+
    '<button class="btn btn-o" onclick="saveLuaKs()">üíæ Salvar .lua</button>'+
    '</div>\n\n'+
    '<span style="color:#4a6080;font-size:.72rem">'+
    'üõ°Ô∏è Script em Base64 no .lua ‚Äî n√£o d√° pra ler direto\n'+
    'üîê Key virou hash de 8 chars ‚Äî ningu√©m v√™ a key original\n'+
    'üö´ 5 erros seguidos fecha a GUI automaticamente\n'+
    '‚ö†Ô∏è Guarde a key acima!</span>';

  toast('‚úÖ Key: '+key+' ‚Äî Guarde ela!');
}

function cpLuaCode(){ if(window._ksLastCode) cpText(window._ksLastCode); }
function saveLuaKs(){
  if(!window._ksLastCode){ toast('‚ö†Ô∏è Gere o key system primeiro!',true); return; }
  var a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([window._ksLastCode],{type:'text/plain'}));
  a.download='keysystem_knx.lua'; a.click();
  toast('‚úÖ .lua salvo!');
}

// ===== LOADSTRING =====
function genLS(){
  var url=G('ls-url').value.trim();
  if(!url){ toast('‚ö†Ô∏è Cole um link!',true); return; }
  if(!url.startsWith('http')){ toast('‚ö†Ô∏è Link inv√°lido!',true); return; }
  var ls='loadstring(game:HttpGet("'+url+'"))()';
  showR('ls-r',ls);
  G('ls-a').style.display='flex';
  toast('‚úÖ LoadString gerado!');
}

// ===== KNXCURTOR =====
var _curtorHTML='';
function genCurtor(){
  var t=G('cur-titulo').value.trim()||'Meu Script';
  var c=G('cur-criador').value.trim()||'Dev';
  var l=G('cur-link').value.trim();
  var yt=G('cur-yt').value.trim();
  var tempo=parseInt(G('cur-tempo').value)||15;
  if(!l){ toast('‚ö†Ô∏è Cole o link do script!',true); return; }

  _curtorHTML='<!DOCTYPE html>\n<html lang="pt-BR">\n<head>\n<meta charset="UTF-8">\n'+
'<meta name="viewport" content="width=device-width,initial-scale=1">\n'+
'<title>'+t+'</title>\n<style>\n'+
'*{margin:0;padding:0;box-sizing:border-box}\n'+
'body{background:#070a0f;color:#dde6f0;font-family:Segoe UI,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;text-align:center;padding:2rem}\n'+
'.box{background:#0c1018;border:1px solid #1a2333;border-radius:14px;padding:2.5rem;max-width:420px;width:100%}\n'+
'h2{font-size:1.7rem;font-weight:900;color:#00d4ff;margin-bottom:.3rem}\n'+
'.sub{color:#4a6080;font-size:.85rem;margin-bottom:2rem}\n'+
'#cnt{font-size:4.5rem;font-weight:900;color:#fff;margin:1rem 0;line-height:1}\n'+
'.msg{color:#4a6080;font-size:.9rem;margin-bottom:1.5rem}\n'+
'.yt{display:'+(yt?'inline-block':'none')+';background:#ff0000;color:#fff;text-decoration:none;padding:.6rem 1.5rem;border-radius:6px;font-weight:700;margin-bottom:1rem;font-size:.88rem}\n'+
'.get{display:none;background:#00d4ff;color:#070a0f;border:none;border-radius:8px;padding:.85rem 2.5rem;font-size:1rem;font-weight:900;cursor:pointer;width:100%;letter-spacing:1px}\n'+
'.foot{color:#1a2333;font-size:.7rem;margin-top:1.5rem;font-family:monospace}\n'+
'</style></head><body>\n'+
'<div class="box">\n'+
'<h2>'+t+'</h2>\n'+
'<div class="sub">por '+c+'</div>\n'+
'<div id="cnt">'+tempo+'</div>\n'+
'<div class="msg" id="msg">Aguarde para liberar o script...</div>\n'+
(yt?'<a class="yt" href="'+yt+'" target="_blank">üî¥ Se inscreva no canal!</a><br>\n':'')+
'<button class="get" id="getbtn" onclick="location.href=\''+l+'\'">‚úÖ Pegar Script</button>\n'+
'</div>\n<div class="foot">KnxMain v2.0 ¬∑ KnxCurtor</div>\n'+
'<script>\nvar s='+tempo+';var iv=setInterval(function(){s--;document.getElementById("cnt").textContent=s;if(s<=0){clearInterval(iv);document.getElementById("cnt").style.display="none";document.getElementById("msg").textContent="Pronto!";document.getElementById("getbtn").style.display="block";}},1000);\n<\/script>\n</body></html>';

  showR('cur-r','‚úÖ P√ÅGINA GERADA!\n\nT√≠tulo: '+t+'\nCriador: '+c+'\nEspera: '+tempo+'s\n\nClique em Visualizar ou Salvar HTML.');
  G('cur-a').style.display='flex';
  toast('‚úÖ P√°gina gerada!');
}
function prevCurtor(){
  var w=window.open('','_blank');
  if(w){ w.document.write(_curtorHTML); w.document.close(); }
  else toast('‚ö†Ô∏è Permita pop-ups!',true);
}
function saveCurtor(){
  var a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([_curtorHTML],{type:'text/html'}));
  a.download='knxcurtor.html'; a.click();
  toast('‚úÖ HTML salvo!');
}

// ===== CHECKER =====
function checkScript(){
  var code=G('chk-in').value.trim();
  if(!code){ toast('‚ö†Ô∏è Cole um script!',true); return; }
  var errs=[],lines=code.split('\n');
  var opens=(code.match(/\b(function|do|then|repeat)\b/g)||[]).length;
  var ends=(code.match(/\bend\b/g)||[]).length;
  if(Math.abs(opens-ends)>2) errs.push('‚ö†Ô∏è end faltando/sobrando ('+opens+' aberturas vs '+ends+' ends)');
  var oP=(code.match(/\(/g)||[]).length,cP=(code.match(/\)/g)||[]).length;
  if(oP!==cP) errs.push('‚ùå Par√™nteses: '+oP+' "(" vs '+cP+' ")"');
  var oB=(code.match(/\[/g)||[]).length,cB=(code.match(/\]/g)||[]).length;
  if(oB!==cB) errs.push('‚ùå Colchetes: '+oB+' "[" vs '+cB+' "]"');
  if(!errs.length){
    showR('chk-r','‚úÖ SEM ERROS ENCONTRADOS!\n\nüìä Estat√≠sticas:\n‚Ä¢ Linhas: '+lines.length+'\n‚Ä¢ Caracteres: '+code.length+'\n‚Ä¢ Functions: '+((code.match(/\bfunction\b/g)||[]).length)+'\n‚Ä¢ Locals: '+((code.match(/\blocal\b/g)||[]).length));
    toast('‚úÖ Script OK!');
  } else {
    showR('chk-r','‚ùå POSS√çVEIS ERROS:\n\n'+errs.join('\n\n'),true);
    toast('‚ùå Erros encontrados!',true);
  }
}
</script>
</body>
</html>
