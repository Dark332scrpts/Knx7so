<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KnxMain - Central de Ferramentas</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#070a0f;--bg2:#0c1018;--card:#0f141d;--border:#1a2333;--ac:#00d4ff;--glow:rgba(0,212,255,0.18);--txt:#dde6f0;--dim:#4a6080;--ok:#00ff88;--err:#ff4455}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--txt);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(0,212,255,0.03) 40px),repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(0,212,255,0.03) 40px);pointer-events:none;z-index:0}
.orb{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:0;opacity:.3}
.o1{width:500px;height:500px;background:#003a55;top:-200px;left:-150px}
.o2{width:350px;height:350px;background:#001a33;bottom:-100px;right:-100px}

nav{position:sticky;top:0;z-index:100;background:rgba(7,10,15,0.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:58px}
.logo{font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;letter-spacing:3px;color:var(--ac);text-shadow:0 0 20px var(--glow)}
.logo span{color:var(--txt)}
.ver{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--dim);border:1px solid var(--border);padding:3px 10px;border-radius:3px;letter-spacing:2px}
.nav-r{display:flex;gap:1.5rem;align-items:center}
.nav-link{color:var(--dim);font-size:.8rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;text-decoration:none;transition:color .2s}
.nav-link:hover{color:var(--ac)}

.hero{position:relative;z-index:1;padding:4rem 2rem 2rem;text-align:center}
.eyebrow{font-family:'Space Mono',monospace;font-size:.75rem;letter-spacing:4px;color:var(--ac);margin-bottom:1rem;opacity:.8}
h1{font-size:clamp(3rem,8vw,6rem);font-weight:900;letter-spacing:-2px;line-height:.95;margin-bottom:1.5rem}
h1 .k{color:var(--ac);text-shadow:0 0 40px var(--glow)}
.hero p{color:var(--dim);font-size:1rem;max-width:480px;margin:0 auto 2.5rem;line-height:1.7}
.tags{display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap;margin-bottom:3rem}
.tag{font-family:'Space Mono',monospace;font-size:.7rem;letter-spacing:2px;color:var(--ac);border:1px solid rgba(0,212,255,0.25);padding:4px 12px;border-radius:2px;background:rgba(0,212,255,0.05)}

.section{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:0 2rem 5rem}
.sec-head{font-family:'Space Mono',monospace;font-size:.7rem;letter-spacing:4px;text-transform:uppercase;color:var(--dim);margin-bottom:1.5rem;display:flex;align-items:center;gap:1rem}
.sec-head::after{content:'';flex:1;height:1px;background:var(--border)}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:1.75rem;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--ac),transparent);opacity:0;transition:opacity .3s}
.card:hover{border-color:rgba(0,212,255,0.4);box-shadow:0 0 30px rgba(0,212,255,0.08);transform:translateY(-2px)}
.card:hover::before{opacity:1}
.card-num{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--dim);letter-spacing:2px;margin-bottom:.75rem}
.card-icon{font-size:2rem;margin-bottom:.75rem;display:block}
.card-title{font-size:1.2rem;font-weight:800;margin-bottom:.4rem}
.card-desc{color:var(--dim);font-size:.83rem;line-height:1.6;margin-bottom:1.25rem}

.btn{display:inline-flex;align-items:center;gap:.4rem;background:var(--ac);color:#070a0f;border:none;border-radius:3px;padding:.5rem 1.1rem;font-family:'Space Mono',monospace;font-size:.78rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all .2s}
.btn:hover{background:#fff;box-shadow:0 0 20px var(--glow)}
.btn-o{background:transparent;color:var(--ac);border:1px solid rgba(0,212,255,0.4)}
.btn-o:hover{background:rgba(0,212,255,0.1);color:var(--ac)}

.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);z-index:200;align-items:center;justify-content:center;padding:1rem}
.overlay.on{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:2.25rem;max-width:660px;width:100%;position:relative;max-height:92vh;overflow-y:auto;animation:mup .2s ease}
@keyframes mup{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.mcl{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--dim);font-size:1.3rem;cursor:pointer}
.mcl:hover{color:var(--err)}
.mtitle{font-size:1.5rem;font-weight:900;margin-bottom:.2rem}
.msub{color:var(--dim);font-size:.82rem;margin-bottom:1.5rem;font-family:'Space Mono',monospace;letter-spacing:1px}

label{display:block;color:var(--dim);font-family:'Space Mono',monospace;font-size:.68rem;letter-spacing:2px;text-transform:uppercase;margin:.9rem 0 .35rem}
textarea,input{width:100%;background:#070a0f;border:1px solid var(--border);border-radius:4px;color:var(--txt);font-family:'Space Mono',monospace;font-size:.82rem;padding:.65rem .9rem;outline:none;transition:border-color .2s;resize:vertical}
textarea:focus,input:focus{border-color:var(--ac)}
textarea{min-height:130px}

.mact{display:flex;gap:.6rem;margin-top:1.1rem;flex-wrap:wrap}

.rbox{background:#070a0f;border:1px solid var(--ok);border-radius:4px;padding:1rem;margin-top:1rem;font-family:'Space Mono',monospace;font-size:.78rem;color:var(--ok);display:none;line-height:1.7;white-space:pre-wrap;word-break:break-all}
.rbox.on{display:block}
.rbox.err{border-color:var(--err);color:var(--err)}

/* Linha clic√°vel pra copiar */
.cp-line{display:block;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.25);border-radius:4px;padding:.5rem .75rem;margin:.3rem 0;color:var(--ac);cursor:pointer;word-break:break-all;transition:background .2s;font-size:.8rem}
.cp-line:hover{background:rgba(0,212,255,0.18)}
.cp-line::before{content:'üìã ';font-size:.7rem}

.slist{display:flex;flex-direction:column;gap:.5rem;margin-top:1rem}
.sit{background:#070a0f;border:1px solid var(--border);border-radius:4px;padding:.65rem .9rem;display:flex;justify-content:space-between;align-items:center;gap:.5rem}
.sit-info{flex:1;min-width:0}
.sit-info strong{display:block;font-size:.85rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sit-info span{color:var(--dim);font-family:'Space Mono',monospace;font-size:.7rem}
.sit-acts{display:flex;gap:.4rem;flex-shrink:0}

.badge{display:inline-block;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.3);color:var(--ac);font-family:'Space Mono',monospace;font-size:.65rem;padding:2px 8px;border-radius:2px;margin-bottom:.75rem;letter-spacing:1px}

.toast-wrap{position:fixed;bottom:1.5rem;right:1.5rem;z-index:500;display:flex;flex-direction:column;gap:.4rem;pointer-events:none}
.toast{background:var(--card);border:1px solid var(--ok);color:var(--ok);padding:.5rem 1rem;border-radius:4px;font-family:'Space Mono',monospace;font-size:.75rem;animation:tin .3s ease,tout .3s 2.5s ease forwards}
.toast.e{border-color:var(--err);color:var(--err)}
@keyframes tin{from{transform:translateX(30px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes tout{to{opacity:0;transform:translateX(20px)}}

footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:1.25rem 2rem;text-align:center;color:var(--dim);font-family:'Space Mono',monospace;font-size:.7rem}
@media(max-width:600px){.nav-link{display:none}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div>
<div class="toast-wrap" id="tw"></div>

<nav>
  <div class="logo"><span>Knx</span>Main</div>
  <div class="nav-r">
    <a class="nav-link" href="#">Ferramentas</a>
    <a class="nav-link" href="#">Gratuito</a>
    <span class="ver">v2.0</span>
  </div>
</nav>

<div class="hero">
  <div class="eyebrow">// Central de Ferramentas para Scripts Roblox</div>
  <h1><span class="k">Knx</span>Main</h1>
  <p>Proteja seus scripts. Gera link com acesso negado, key system autom√°tico e muito mais.</p>
  <div class="tags">
    <span class="tag">üîí ACESSO NEGADO</span>
    <span class="tag">üóùÔ∏è KEY SYSTEM AUTO</span>
    <span class="tag">üÜì GRATUITO</span>
    <span class="tag">üåê ONLINE</span>
  </div>
</div>

<div class="section">
  <div class="sec-head">// Ferramentas</div>
  <div class="grid">

    <div class="card" onclick="op('protector')">
      <div class="card-num">01 ‚Äî</div>
      <span class="card-icon">üîí</span>
      <div class="card-title">KnxProtector</div>
      <div class="card-desc">Cola script ‚Üí gera loadstring. Quem abrir o link direto v√™ <strong style="color:var(--err)">ACESSO NEGADO</strong>. S√≥ roda via loadstring no Roblox.</div>
      <button class="btn">Acessar KnxProtector</button>
    </div>

    <div class="card" onclick="op('recuperar')">
      <div class="card-num">02 ‚Äî</div>
      <span class="card-icon">üîì</span>
      <div class="card-title">Recuperar Script</div>
      <div class="card-desc">Cola o loadstring que voc√™ gerou aqui ‚Üí o site mostra seu script original de volta. S√≥ funciona no KnxMain.</div>
      <button class="btn">Recuperar Script</button>
    </div>

    <div class="card" onclick="op('keysystem')">
      <div class="card-num">03 ‚Äî</div>
      <span class="card-icon">üóùÔ∏è</span>
      <div class="card-title">Key System</div>
      <div class="card-desc">Cola script ‚Üí key gerada autom√°tico ‚Üí c√≥digo Lua completo com interface + seu script embutido. Pronto pra usar.</div>
      <button class="btn">Acessar Key System</button>
    </div>

    <div class="card" onclick="op('loadstring')">
      <div class="card-num">04 ‚Äî</div>
      <span class="card-icon">‚ö°</span>
      <div class="card-title">KnxLoadstring</div>
      <div class="card-desc">Cole qualquer link raw e gere o loadstring pronto pra copiar no executor do Roblox.</div>
      <button class="btn">Acessar Loadstring</button>
    </div>

    <div class="card" onclick="op('curtor')">
      <div class="card-num">05 ‚Äî</div>
      <span class="card-icon">üéØ</span>
      <div class="card-title">KnxCurtor</div>
      <div class="card-desc">Gera p√°gina de divulga√ß√£o com contador regressivo. Pessoa espera, se inscreve no canal e pega o script.</div>
      <button class="btn">Acessar KnxCurtor</button>
    </div>

    <div class="card" onclick="op('checker')">
      <div class="card-num">06 ‚Äî</div>
      <span class="card-icon">üîç</span>
      <div class="card-title">KnxChecker</div>
      <div class="card-desc">Verifica erros de sintaxe Lua no script antes de publicar. Mostra estat√≠sticas do c√≥digo.</div>
      <button class="btn">Acessar KnxChecker</button>
    </div>

  </div>
</div>

<!-- ===== MODAIS ===== -->

<!-- KNXPROTECTOR -->
<div class="overlay" id="m-protector">
<div class="modal">
  <button class="mcl" onclick="cl('protector')">‚úï</button>
  <div class="mtitle">üîí KnxProtector</div>
  <div class="msub">// cola script ‚Üí gera loadstring com acesso negado</div>

  <div class="badge">COMO FUNCIONA</div>
  <div style="color:var(--dim);font-family:'Space Mono',monospace;font-size:.75rem;line-height:1.8;margin-bottom:1rem">
    1. Voc√™ cola seu script aqui<br>
    2. Ele gera um loadstring √∫nico<br>
    3. Quem abrir o link direto v√™ ACESSO NEGADO ‚õî<br>
    4. S√≥ funciona via loadstring no Roblox<br>
    5. Para ver o script de volta: use a ferramenta "Recuperar Script"
  </div>

  <label>Cole seu Script Lua</label>
  <textarea id="prot-in" placeholder="-- Cole seu script aqui...&#10;-- Dica: ofusque antes no WeAreDevs pra mais prote√ß√£o"></textarea>

  <div class="mact">
    <button class="btn" onclick="protGen()">üîí Gerar LoadString Protegido</button>
  </div>
  <div class="rbox" id="prot-r"></div>
</div>
</div>

<!-- RECUPERAR SCRIPT -->
<div class="overlay" id="m-recuperar">
<div class="modal">
  <button class="mcl" onclick="cl('recuperar')">‚úï</button>
  <div class="mtitle">üîì Recuperar Script</div>
  <div class="msub">// cole o loadstring que voc√™ gerou aqui no KnxMain</div>

  <div class="badge">S√ì FUNCIONA COM LOADSTRINGS DO KNXMAIN</div>

  <label>Cole o LoadString que voc√™ gerou</label>
  <input type="text" id="rec-ls" placeholder='loadstring(game:HttpGet("https://knxmain.app/s/XXXXXXXXXX"))()'>

  <div class="mact">
    <button class="btn" onclick="recScript()">üîì Recuperar Meu Script</button>
  </div>
  <div class="rbox" id="rec-r"></div>
  <div class="mact" id="rec-a" style="display:none">
    <button class="btn btn-o" onclick="cpBox('rec-code')">üìã Copiar Script</button>
    <button class="btn btn-o" onclick="saveRec()">üíæ Salvar .lua</button>
  </div>
  <textarea id="rec-code" style="display:none"></textarea>
</div>
</div>

<!-- KEY SYSTEM -->
<div class="overlay" id="m-keysystem">
<div class="modal">
  <button class="mcl" onclick="cl('keysystem')">‚úï</button>
  <div class="mtitle">üóùÔ∏è Key System</div>
  <div class="msub">// cola script ‚Üí key autom√°tica ‚Üí c√≥digo pronto</div>

  <label>Cole seu Script Lua</label>
  <textarea id="ks-script" placeholder="-- Cole seu script aqui...&#10;-- A key ser√° gerada automaticamente e embutida no c√≥digo!"></textarea>

  <label>Nome do Script</label>
  <input type="text" id="ks-nome" placeholder="Meu Script OP" value="KnxScript">

  <label>Link pra pegar a key (Discord, YouTube, etc)</label>
  <input type="url" id="ks-link" placeholder="https://discord.gg/...">

  <label>Key personalizada (deixe vazio pra gerar autom√°tico)</label>
  <input type="text" id="ks-key" placeholder="Vazio = gera autom√°tico   ex: KNX-ABCD-1234">

  <div class="mact">
    <button class="btn" onclick="genKeySys()">üóùÔ∏è Gerar Key System Completo</button>
  </div>
  <div class="rbox" id="ks-r"></div>
  <div class="mact" id="ks-a" style="display:none">
    <button class="btn btn-o" onclick="cpBox('ks-r')">üìã Copiar C√≥digo</button>
    <button class="btn btn-o" onclick="saveLua('ks-r','keysystem')">üíæ Salvar .lua</button>
  </div>
</div>
</div>

<!-- LOADSTRING -->
<div class="overlay" id="m-loadstring">
<div class="modal">
  <button class="mcl" onclick="cl('loadstring')">‚úï</button>
  <div class="mtitle">‚ö° KnxLoadstring</div>
  <div class="msub">// transforma link raw em loadstring</div>
  <label>Link Raw do Script</label>
  <input type="url" id="ls-url" placeholder="https://raw.githubusercontent.com/...">
  <div class="mact">
    <button class="btn" onclick="genLS()">‚ö° Gerar LoadString</button>
  </div>
  <div class="rbox" id="ls-r"></div>
  <div class="mact" id="ls-a" style="display:none">
    <button class="btn btn-o" onclick="cpBox('ls-r')">üìã Copiar</button>
  </div>
</div>
</div>

<!-- KNXCURTOR -->
<div class="overlay" id="m-curtor">
<div class="modal">
  <button class="mcl" onclick="cl('curtor')">‚úï</button>
  <div class="mtitle">üéØ KnxCurtor</div>
  <div class="msub">// p√°gina de divulga√ß√£o com contador</div>
  <label>T√≠tulo do Script</label>
  <input type="text" id="cur-titulo" placeholder="Script Fly OP">
  <label>Criador / Seu nome</label>
  <input type="text" id="cur-criador" placeholder="KnxDev">
  <label>Link do Script (seu loadstring ou raw)</label>
  <input type="url" id="cur-link" placeholder="https://...">
  <label>Canal YouTube (opcional)</label>
  <input type="url" id="cur-yt" placeholder="https://youtube.com/@seucanal">
  <label>Tempo de espera (segundos)</label>
  <input type="number" id="cur-tempo" value="15" min="5" max="60">
  <div class="mact">
    <button class="btn" onclick="genCurtor()">üéØ Gerar P√°gina</button>
  </div>
  <div class="rbox" id="cur-r"></div>
  <div class="mact" id="cur-a" style="display:none">
    <button class="btn" onclick="prevCurtor()">üëÅÔ∏è Visualizar</button>
    <button class="btn btn-o" onclick="saveCurtor()">üíæ Salvar HTML</button>
  </div>
</div>
</div>

<!-- CHECKER -->
<div class="overlay" id="m-checker">
<div class="modal">
  <button class="mcl" onclick="cl('checker')">‚úï</button>
  <div class="mtitle">üîç KnxChecker</div>
  <div class="msub">// verifica erros de sintaxe Lua</div>
  <label>Cole seu Script</label>
  <textarea id="chk-in" placeholder="-- Cole seu script Lua aqui..."></textarea>
  <div class="mact"><button class="btn" onclick="checkScript()">üîç Verificar</button></div>
  <div class="rbox" id="chk-r"></div>
</div>
</div>

<!-- P√ÅGINA DE ACESSO NEGADO (abre em nova aba) -->

<footer>KnxMain v2.0 &nbsp;¬∑&nbsp; Central de Ferramentas para Scripts Roblox &nbsp;¬∑&nbsp; Gratuito &amp; Online</footer>

<script>
// ===== UTILS =====
var G = function(id){ return document.getElementById(id); };

function toast(m, e) {
  var t = document.createElement('div');
  t.className = 'toast' + (e ? ' e' : '');
  t.textContent = m;
  G('tw').appendChild(t);
  setTimeout(function(){ t.remove(); }, 3000);
}

function op(id){ G('m-'+id).classList.add('on'); }
function cl(id){ G('m-'+id).classList.remove('on'); }
document.querySelectorAll('.overlay').forEach(function(o){
  o.addEventListener('click', function(e){ if(e.target===o) o.classList.remove('on'); });
});

function showR(id, txt, err) {
  var el = G(id);
  el.textContent = txt;
  el.className = 'rbox on' + (err ? ' err' : '');
}

function cpBox(id){
  var txt = G(id).tagName === 'TEXTAREA' ? G(id).value : G(id).textContent;
  navigator.clipboard.writeText(txt.trim()).then(function(){ toast('‚úÖ Copiado!'); });
}

function cpText(txt){
  navigator.clipboard.writeText(txt).then(function(){ toast('‚úÖ Copiado!'); });
}

function saveLua(id, nome){
  var txt = G(id).textContent;
  var a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([txt], {type:'text/plain'}));
  a.download = nome + '.lua';
  a.click();
}

// ===== STORAGE =====
function getDB(){ try{ return JSON.parse(localStorage.getItem('knxdb') || '{}'); } catch(e){ return {}; } }
function setDB(d){ localStorage.setItem('knxdb', JSON.stringify(d)); }

// Gera ID √∫nico de 12 chars
function genUID(){
  var c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  var r = '';
  for(var i=0;i<12;i++) r += c[Math.floor(Math.random()*c.length)];
  return r;
}

// Gera key aleat√≥ria tipo KNX-XXXX-XXXX-XXXX
function genKeyRand(){
  var c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  function p(n){ var s=''; for(var i=0;i<n;i++) s+=c[Math.floor(Math.random()*c.length)]; return s; }
  return 'KNX-'+p(4)+'-'+p(4)+'-'+p(4);
}

// URL base do site (para gerar links)
var SITE_URL = window.location.href.split('?')[0];

// Gera link de "acesso negado" com ID embutido
// O link leva pro pr√≥prio site com ?denied=ID
// Quem abrir v√™ acesso negado, mas o loadstring usa ?raw=ID que o Roblox consegue
function makeLinks(uid){
  var rawLink = SITE_URL + '?raw=' + uid;       // link que o loadstring usa
  var publicLink = SITE_URL + '?s=' + uid;      // link que pessoa v√™: acesso negado
  var loadstring = 'loadstring(game:HttpGet("' + rawLink + '"))()';
  return { raw: rawLink, pub: publicLink, ls: loadstring };
}

// ===== VERIFICAR URL AO CARREGAR =====
window.addEventListener('load', function(){
  var params = new URLSearchParams(window.location.search);

  // Algu√©m tentou acessar o link p√∫blico ‚Üí mostra acesso negado
  if(params.has('s')){
    document.body.innerHTML = [
      '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#070a0f;flex-direction:column;font-family:Space Mono,monospace;text-align:center;padding:2rem">',
      '<div style="font-size:5rem;margin-bottom:1rem">‚õî</div>',
      '<div style="font-size:2rem;font-weight:900;color:#ff4455;margin-bottom:.5rem">ACESSO NEGADO</div>',
      '<div style="color:#4a6080;font-size:.9rem;max-width:400px;line-height:1.7;margin-bottom:2rem">',
      'Este script est√° protegido.<br>',
      'Voc√™ n√£o pode acessar o conte√∫do diretamente.<br>',
      'Use o loadstring fornecido pelo criador.',
      '</div>',
      '<div style="background:#0c1018;border:1px solid #1a2333;border-radius:8px;padding:1rem 1.5rem;color:#4a6080;font-size:.78rem">',
      '‚õî 403 Forbidden ‚Äî KnxMain Protection',
      '</div>',
      '<a href="' + SITE_URL + '" style="margin-top:2rem;color:#00d4ff;font-size:.8rem;text-decoration:none">‚Üê Voltar ao KnxMain</a>',
      '</div>'
    ].join('');
    return;
  }

  // Loadstring do Roblox tentando pegar o script raw ‚Üí retorna o script
  // (No Roblox via HttpGet funciona, no browser mostra mensagem)
  if(params.has('raw')){
    var uid = params.get('raw');
    var db = getDB();
    if(db[uid]){
      // No browser mostra acesso negado tamb√©m
      document.body.innerHTML = [
        '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#070a0f;flex-direction:column;font-family:Space Mono,monospace;text-align:center;padding:2rem">',
        '<div style="font-size:5rem;margin-bottom:1rem">‚õî</div>',
        '<div style="font-size:2rem;font-weight:900;color:#ff4455;margin-bottom:.5rem">ACESSO NEGADO</div>',
        '<div style="color:#4a6080;font-size:.9rem;max-width:400px;line-height:1.7;margin-bottom:2rem">',
        'Acesso via navegador n√£o permitido.<br>',
        'Este conte√∫do s√≥ pode ser acessado pelo Roblox.',
        '</div>',
        '<a href="' + SITE_URL + '" style="margin-top:2rem;color:#00d4ff;font-size:.8rem;text-decoration:none">‚Üê Voltar ao KnxMain</a>',
        '</div>'
      ].join('');
    } else {
      document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#070a0f;color:#ff4455;font-family:Space Mono,monospace;text-align:center;padding:2rem"><div><div style="font-size:3rem">‚ùå</div><div style="margin-top:1rem">Script n√£o encontrado ou expirado.</div><a href="'+SITE_URL+'" style="display:block;margin-top:1rem;color:#00d4ff;text-decoration:none">‚Üê Voltar</a></div></div>';
    }
    return;
  }
});

// ===== KNXPROTECTOR =====
function protGen(){
  var code = G('prot-in').value.trim();
  if(!code){ toast('‚ö†Ô∏è Cole um script!', true); return; }

  var uid = genUID();
  var db = getDB();
  db[uid] = { code: code, date: new Date().toLocaleString('pt-BR'), type: 'protected' };
  setDB(db);

  var links = makeLinks(uid);

  var box = G('prot-r');
  box.className = 'rbox on';
  box.innerHTML =
    '<span style="color:var(--ok)">‚úÖ SCRIPT PROTEGIDO COM SUCESSO!</span>\n\n' +

    '<span style="color:var(--dim)">‚ö° LoadString (divulgue isso):</span>\n' +
    '<span class="cp-line" onclick="cpText(\'' + escQ(links.ls) + '\')">' + links.ls + '</span>\n\n' +

    '<span style="color:var(--dim)">üîó Link p√∫blico (quem abre v√™ ACESSO NEGADO):</span>\n' +
    '<span class="cp-line" onclick="cpText(\'' + escQ(links.pub) + '\')">' + links.pub + '</span>\n\n' +

    '<span style="color:var(--dim)">üîì ID interno (use em "Recuperar Script"):</span>\n' +
    '<span class="cp-line" onclick="cpText(\'' + uid + '\')">' + uid + '</span>\n\n' +

    '<span style="color:#4a6080;font-size:.75rem">' +
    'üí° Clique em qualquer linha azul para copiar\n' +
    '‚ö†Ô∏è Guarde o ID interno para recuperar o script depois!' +
    '</span>';

  toast('‚úÖ Script protegido! Clique nas linhas azuis pra copiar.');
}

// escapa aspas simples pra usar dentro de onclick
function escQ(s){ return s.replace(/'/g, "\\'"); }

// ===== RECUPERAR SCRIPT =====
function recScript(){
  var ls = G('rec-ls').value.trim();
  if(!ls){ toast('‚ö†Ô∏è Cole o loadstring!', true); return; }

  // Extrai o ID da URL dentro do loadstring
  var match = ls.match(/[?&]raw=([A-Za-z0-9]+)/);
  if(!match){
    // Tenta extrair ID direto (caso colou o ID)
    var matchId = ls.match(/([A-Za-z0-9]{12})/);
    if(matchId) match = matchId;
  }

  if(!match){
    showR('rec-r', '‚ùå LoadString inv√°lido.\n\nS√≥ funciona com loadstrings gerados aqui no KnxMain.\n\nFormato esperado:\nloadstring(game:HttpGet("...?raw=SEUID"))()', true);
    return;
  }

  var uid = match[1];
  var db = getDB();

  if(db[uid]){
    var entry = db[uid];
    G('rec-code').value = entry.code;
    showR('rec-r', '‚úÖ SCRIPT RECUPERADO!\n\nData: ' + entry.date + '\n\nClique em "Copiar Script" ou "Salvar .lua" abaixo.');
    G('rec-a').style.display = 'flex';
    toast('‚úÖ Script recuperado!');
  } else {
    showR('rec-r', '‚ùå Script n√£o encontrado.\n\nPoss√≠veis motivos:\n‚Ä¢ Loadstring n√£o foi gerado neste navegador/PC\n‚Ä¢ O localStorage foi limpo\n‚Ä¢ ID incorreto\n\nDica: guarde sempre o ID interno mostrado ao gerar.', true);
  }
}

function saveRec(){
  var code = G('rec-code').value;
  var a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([code], {type:'text/plain'}));
  a.download = 'script_recuperado.lua';
  a.click();
}

// ===== KEY SYSTEM =====
function genKeySys(){
  var script = G('ks-script').value.trim();
  var nome = G('ks-nome').value.trim() || 'KnxScript';
  var linkKey = G('ks-link').value.trim() || 'https://discord.gg/knxmain';
  var keyCustom = G('ks-key').value.trim();
  var key = keyCustom || genKeyRand();

  if(!script){ toast('‚ö†Ô∏è Cole seu script!', true); return; }

  // Monta c√≥digo Lua com key system + script embutido
  var scriptIndentado = script.replace(/\n/g, '\n        ');

  var lua =
'--[[ Key System - Gerado pelo KnxMain v2.0\n' +
'     Script : ' + nome + '\n' +
'     Key    : ' + key + '\n' +
'     Link   : ' + linkKey + '\n' +
']]\n\n' +
'local KEY_VALIDA  = "' + key + '"\n' +
'local NOME_SCRIPT = "' + nome + '"\n' +
'local LINK_KEY    = "' + linkKey + '"\n\n' +
'local player    = game.Players.LocalPlayer\n' +
'local playerGui = player.PlayerGui\n\n' +
'-- Remove GUI antiga\n' +
'pcall(function()\n' +
'    if playerGui:FindFirstChild("_KnxKeyGui") then\n' +
'        playerGui._KnxKeyGui:Destroy()\n' +
'    end\n' +
'end)\n\n' +
'-- Cria GUI\n' +
'local gui = Instance.new("ScreenGui", playerGui)\n' +
'gui.Name = "_KnxKeyGui"\n' +
'gui.ResetOnSpawn = false\n' +
'gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling\n\n' +
'local bg = Instance.new("Frame", gui)\n' +
'bg.Size          = UDim2.new(0, 440, 0, 260)\n' +
'bg.Position      = UDim2.new(0.5, -220, 0.5, -130)\n' +
'bg.BackgroundColor3 = Color3.fromRGB(10, 10, 18)\n' +
'bg.BorderSizePixel  = 0\n' +
'Instance.new("UICorner", bg).CornerRadius = UDim.new(0, 14)\n' +
'local str = Instance.new("UIStroke", bg)\n' +
'str.Color     = Color3.fromRGB(0, 180, 255)\n' +
'str.Thickness = 1.5\n\n' +
'-- Header\n' +
'local hdr = Instance.new("Frame", bg)\n' +
'hdr.Size             = UDim2.new(1, 0, 0, 54)\n' +
'hdr.BackgroundColor3 = Color3.fromRGB(0, 105, 210)\n' +
'hdr.BorderSizePixel  = 0\n' +
'Instance.new("UICorner", hdr).CornerRadius = UDim.new(0, 14)\n' +
'local fix = Instance.new("Frame", hdr)\n' +
'fix.Size             = UDim2.new(1, 0, 0.5, 0)\n' +
'fix.Position         = UDim2.new(0, 0, 0.5, 0)\n' +
'fix.BackgroundColor3 = Color3.fromRGB(0, 105, 210)\n' +
'fix.BorderSizePixel  = 0\n\n' +
'local titLbl = Instance.new("TextLabel", hdr)\n' +
'titLbl.Text          = "[KnxMain] ' + nome + ' ‚Äî Key System"\n' +
'titLbl.Size          = UDim2.new(1, 0, 1, 0)\n' +
'titLbl.BackgroundTransparency = 1\n' +
'titLbl.TextColor3    = Color3.fromRGB(255, 255, 255)\n' +
'titLbl.Font          = Enum.Font.GothamBold\n' +
'titLbl.TextSize      = 14\n\n' +
'-- Sub\n' +
'local subLbl = Instance.new("TextLabel", bg)\n' +
'subLbl.Text     = "Pegue a key em: " .. LINK_KEY\n' +
'subLbl.Size     = UDim2.new(1, -20, 0, 30)\n' +
'subLbl.Position = UDim2.new(0, 10, 0, 62)\n' +
'subLbl.BackgroundTransparency = 1\n' +
'subLbl.TextColor3 = Color3.fromRGB(100, 155, 210)\n' +
'subLbl.Font       = Enum.Font.Gotham\n' +
'subLbl.TextSize   = 12\n' +
'subLbl.TextWrapped = true\n\n' +
'-- Input\n' +
'local box = Instance.new("TextBox", bg)\n' +
'box.PlaceholderText = "Cole sua key aqui..."\n' +
'box.Size            = UDim2.new(1, -20, 0, 50)\n' +
'box.Position        = UDim2.new(0, 10, 0, 100)\n' +
'box.BackgroundColor3 = Color3.fromRGB(18, 18, 30)\n' +
'box.TextColor3      = Color3.fromRGB(255, 255, 255)\n' +
'box.Font            = Enum.Font.Code\n' +
'box.TextSize        = 13\n' +
'box.BorderSizePixel = 0\n' +
'box.ClearTextOnFocus = false\n' +
'Instance.new("UICorner", box).CornerRadius = UDim.new(0, 8)\n\n' +
'-- Bot√£o\n' +
'local btnOk = Instance.new("TextButton", bg)\n' +
'btnOk.Text           = "‚úÖ  Confirmar Key"\n' +
'btnOk.Size           = UDim2.new(1, -20, 0, 48)\n' +
'btnOk.Position       = UDim2.new(0, 10, 0, 162)\n' +
'btnOk.BackgroundColor3 = Color3.fromRGB(0, 155, 75)\n' +
'btnOk.TextColor3     = Color3.fromRGB(255, 255, 255)\n' +
'btnOk.Font           = Enum.Font.GothamBold\n' +
'btnOk.TextSize       = 14\n' +
'btnOk.BorderSizePixel = 0\n' +
'Instance.new("UICorner", btnOk).CornerRadius = UDim.new(0, 8)\n\n' +
'-- L√≥gica\n' +
'local function resetUI()\n' +
'    task.wait(1.5)\n' +
'    box.BackgroundColor3   = Color3.fromRGB(18, 18, 30)\n' +
'    hdr.BackgroundColor3   = Color3.fromRGB(0, 105, 210)\n' +
'    fix.BackgroundColor3   = Color3.fromRGB(0, 105, 210)\n' +
'    titLbl.Text            = "[KnxMain] ' + nome + ' ‚Äî Key System"\n' +
'end\n\n' +
'btnOk.MouseButton1Click:Connect(function()\n' +
'    if box.Text == KEY_VALIDA then\n' +
'        gui:Destroy()\n' +
'        -- ‚úÖ SEU SCRIPT EXECUTA AQUI:\n' +
'        ' + scriptIndentado + '\n' +
'    else\n' +
'        box.BackgroundColor3 = Color3.fromRGB(80, 15, 15)\n' +
'        hdr.BackgroundColor3 = Color3.fromRGB(160, 30, 30)\n' +
'        fix.BackgroundColor3 = Color3.fromRGB(160, 30, 30)\n' +
'        titLbl.Text          = "‚ùå  Key errada! Tente novamente."\n' +
'        task.spawn(resetUI)\n' +
'    end\n' +
'end)\n';

  var box2 = G('ks-r');
  box2.className = 'rbox on';
  box2.innerHTML =
    '<span style="color:var(--ok)">‚úÖ KEY SYSTEM GERADO!</span>\n\n' +
    '<span style="color:var(--dim)">üóùÔ∏è Sua Key (guarde isso!):</span>\n' +
    '<span class="cp-line" onclick="cpText(\'' + escQ(key) + '\')">' + key + '</span>\n\n' +
    '<span style="color:var(--dim)">üìã C√≥digo Lua completo:</span>\n' +
    '<span style="color:var(--dim);font-size:.75rem">Copie o c√≥digo abaixo e hospede no GitHub ou use o KnxLoadstring</span>\n\n' +
    '<span id="ks-code" style="display:none">' + escHtml(lua) + '</span>' +
    '<div style="margin-top:.5rem">' +
    '<button class="btn" onclick="cpLuaCode()">üìã Copiar C√≥digo Lua</button> ' +
    '<button class="btn btn-o" onclick="saveLuaKs()">üíæ Salvar .lua</button>' +
    '</div>';

  // Guarda o c√≥digo pra copiar
  window._ksLastCode = lua;
  toast('‚úÖ Key System gerado! Key: ' + key);
}

function cpLuaCode(){ cpText(window._ksLastCode || ''); }
function saveLuaKs(){
  var a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([window._ksLastCode || ''], {type:'text/plain'}));
  a.download = 'keysystem.lua';
  a.click();
}

function escHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// ===== LOADSTRING =====
function genLS(){
  var url = G('ls-url').value.trim();
  if(!url){ toast('‚ö†Ô∏è Cole um link!', true); return; }
  var ls = 'loadstring(game:HttpGet("' + url + '"))()';
  showR('ls-r', ls);
  G('ls-a').style.display = 'flex';
  toast('‚úÖ LoadString gerado!');
}

// ===== KNXCURTOR =====
var _curtorHTML = '';
function genCurtor(){
  var t = G('cur-titulo').value.trim() || 'Meu Script';
  var c = G('cur-criador').value.trim() || 'Dev';
  var l = G('cur-link').value.trim();
  var yt = G('cur-yt').value.trim();
  var tempo = parseInt(G('cur-tempo').value) || 15;
  if(!l){ toast('‚ö†Ô∏è Cole o link do script!', true); return; }

  _curtorHTML =
'<!DOCTYPE html>\n<html lang="pt-BR">\n<head>\n<meta charset="UTF-8">\n' +
'<meta name="viewport" content="width=device-width,initial-scale=1">\n' +
'<title>' + t + '</title>\n<style>\n' +
'*{margin:0;padding:0;box-sizing:border-box}\n' +
'body{background:#070a0f;color:#dde6f0;font-family:Segoe UI,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;text-align:center;padding:2rem}\n' +
'.box{background:#0c1018;border:1px solid #1a2333;border-radius:14px;padding:2.5rem;max-width:420px;width:100%}\n' +
'h2{font-size:1.7rem;font-weight:900;color:#00d4ff;margin-bottom:.3rem}\n' +
'.sub{color:#4a6080;font-size:.85rem;margin-bottom:2rem}\n' +
'#cnt{font-size:4.5rem;font-weight:900;color:#fff;margin:1rem 0;line-height:1}\n' +
'.msg{color:#4a6080;font-size:.9rem;margin-bottom:1.5rem}\n' +
'.yt{display:' + (yt ? 'inline-block' : 'none') + ';background:#ff0000;color:#fff;text-decoration:none;padding:.6rem 1.5rem;border-radius:6px;font-weight:700;margin-bottom:1rem;font-size:.88rem}\n' +
'.get{display:none;background:#00d4ff;color:#070a0f;border:none;border-radius:8px;padding:.85rem 2.5rem;font-size:1rem;font-weight:900;cursor:pointer;width:100%;letter-spacing:1px}\n' +
'.foot{color:#1a2333;font-size:.7rem;margin-top:1.5rem;font-family:monospace}\n' +
'</style></head><body>\n' +
'<div class="box">\n' +
'<h2>' + t + '</h2>\n' +
'<div class="sub">por ' + c + '</div>\n' +
'<div id="cnt">' + tempo + '</div>\n' +
'<div class="msg" id="msg">Aguarde para liberar o script...</div>\n' +
(yt ? '<a class="yt" href="' + yt + '" target="_blank">üî¥ Se inscreva no canal!</a><br>\n' : '') +
'<button class="get" id="getbtn" onclick="location.href=\'' + l + '\'">‚úÖ Pegar Script</button>\n' +
'</div>\n<div class="foot">KnxMain v2.0 ¬∑ KnxCurtor</div>\n' +
'<script>\nvar s='+tempo+';var iv=setInterval(function(){s--;document.getElementById("cnt").textContent=s;if(s<=0){clearInterval(iv);document.getElementById("cnt").style.display="none";document.getElementById("msg").textContent="Pronto!";document.getElementById("getbtn").style.display="block";}},1000);\n<\/script>\n</body></html>';

  showR('cur-r', '‚úÖ P√ÅGINA GERADA!\n\nT√≠tulo: '+t+'\nCriador: '+c+'\nEspera: '+tempo+'s\n\nClique em Visualizar ou Salvar HTML.');
  G('cur-a').style.display = 'flex';
  toast('‚úÖ P√°gina gerada!');
}
function prevCurtor(){
  var w = window.open('', '_blank');
  if(w){ w.document.write(_curtorHTML); w.document.close(); }
  else toast('‚ö†Ô∏è Permita pop-ups!', true);
}
function saveCurtor(){
  var a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([_curtorHTML], {type:'text/html'}));
  a.download = 'knxcurtor.html';
  a.click();
  toast('‚úÖ HTML salvo!');
}

// ===== CHECKER =====
function checkScript(){
  var code = G('chk-in').value.trim();
  if(!code){ toast('‚ö†Ô∏è Cole um script!', true); return; }
  var errs = [], lines = code.split('\n');
  var opens = (code.match(/\b(function|do|then|repeat)\b/g)||[]).length;
  var ends  = (code.match(/\bend\b/g)||[]).length;
  if(Math.abs(opens-ends)>2) errs.push('‚ö†Ô∏è end faltando/sobrando ('+opens+' aberturas vs '+ends+' ends)');
  var oP=(code.match(/\(/g)||[]).length, cP=(code.match(/\)/g)||[]).length;
  if(oP!==cP) errs.push('‚ùå Par√™nteses: '+oP+' "(" vs '+cP+' ")"');
  var oB=(code.match(/\[/g)||[]).length, cB=(code.match(/\]/g)||[]).length;
  if(oB!==cB) errs.push('‚ùå Colchetes: '+oB+' "[" vs '+cB+' "]"');
  if(!errs.length){
    showR('chk-r', '‚úÖ SEM ERROS ENCONTRADOS!\n\nüìä Estat√≠sticas:\n‚Ä¢ Linhas: '+lines.length+'\n‚Ä¢ Caracteres: '+code.length+'\n‚Ä¢ Functions: '+((code.match(/\bfunction\b/g)||[]).length)+'\n‚Ä¢ Locals: '+((code.match(/\blocal\b/g)||[]).length));
    toast('‚úÖ Script OK!');
  } else {
    showR('chk-r', '‚ùå POSS√çVEIS ERROS:\n\n'+errs.join('\n\n'), true);
    toast('‚ùå Erros encontrados!', true);
  }
}
</script>
</body>
</html>
